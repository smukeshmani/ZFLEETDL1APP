var string="";var approval_lvl="";var task="";sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/ui/model/BindingMode","sap/ui/core/message/Message","sap/ui/core/MessageType","sap/ui/core/ValueState","sap/m/MessageToast","sap/ui/core/library"],function(e,l,o,t,s,a,r,i){"use strict";return e.extend("ZGBC_DELIVERY_TRUCK_APPROVE.ZGBC_DELIVERY_TRUCK_APPROVE.controller.View1",{onInit:function(){var e,l;l=this.getView();e=sap.ui.getCore().getMessageManager();l.setModel(e.getMessageModel(),"message");var o={ApprovalLvl:"",Comments:""};this.oLocalModel=new sap.ui.model.json.JSONModel(o);l.setModel(this.oLocalModel,"localModel");var t={Vehicles:[],VehicleSelected:null,VehicleDDVisible:false,VehicleSelectVis:false,MsgVisible:false,MsgType:"Success",MsgText:""};this.oLocalModel2=new sap.ui.model.json.JSONModel(t);l.setModel(this.oLocalModel2,"localModel2");var s={ApprovalChecksVisible:false,VehicleDetVisible:false,FleetExists:false,UnitAllocated:false,SumitRequestVisible:false};this.oLocalModel3=new sap.ui.model.json.JSONModel(s);l.setModel(this.oLocalModel3,"localModel3");var a={Vehicleid:"",VehicleName:"",VehicleVendor:"",VehicleNumber:"",Plant:"",Location:"",CostCenter:""};this.oLocalVhModel=new sap.ui.model.json.JSONModel(a);l.setModel(this.oLocalVhModel,"localVhModel");var r=window.location.href;var i=r.split("?");var c=i.length;c=c-1;var d=i[c].split("&");var p=d[0].split("=");string=p[1];var V=string;p=d[1].split("=");string=p[1];var n=string;p=d[2].split("=");string=p[1];var M=string;var h="/WorkitemSet('"+n+"')";var u=l.getModel();var v=this;u.read(h,{success:function(e,l){v.getView().getModel("localModel").setProperty("/ApprovalLvl",e.ApprovalLvl);approval_lvl=v.getView().getModel("localModel").getProperty("/ApprovalLvl");task=M;h="/FleetRequestHeaderSet('"+V+"')";u.read(h,{urlParameters:{$expand:"RequestHeaderToItemNav"},success:function(e,l){var o=new sap.ui.model.json.JSONModel(e);var t=v.getView().byId("IdEmpDetail");t.setModel(o);if(approval_lvl==="FLM"){v.getView().getModel("localModel3").setProperty("/VehicleDetVisible",false);v.getView().getModel("localModel3").setProperty("/SumitRequestVisible",true);h="/VehicleDropDownSet";var s="RequestId eq '"+V+"' and ApprovalLbl eq '"+approval_lvl+"'";u.read(h,{urlParameters:{$filter:s},success:function(e,l){v.oLocalModel2.setProperty("/Vehicles",e.results);v.oLocalModel2.setProperty("/VehicleDDVisible",true);v.oLocalModel2.setProperty("/VehicleSelectVis",true)},error:function(){v.oLocalModel2.setProperty("/VehicleSelectVis",true);v.oLocalModel2.setProperty("/VehicleDDVisible",false);v.oLocalModel2.setProperty("/MsgType","Success");v.oLocalModel2.setProperty("/MsgVisible",true);v.oLocalModel2.setProperty("/MsgText","No vehicles found to select, So please save the data and approve to pass it to next level")}})}},error:function(){v.getView().getModel("localModel").setProperty("/VehicleDetVisible",false);sap.m.MessageToast.show("No Data retreived")}})},error:function(){}})},onSelectVehicle:function(e){var l=this.getView().getModel("localModel2").getProperty("/VehicleSelected");var o=this.getView().getModel();var t="/VehicleDetails3Set('"+l+"')";var s=this;o.read(t,{success:function(e,l){s.oLocalVhModel.setProperty("/Vehicleid",e.VehicleId);s.oLocalVhModel.setProperty("/VehicleName",e.VehicleText);s.oLocalVhModel.setProperty("/VehicleVendor",e.VehicleVendor);s.oLocalVhModel.setProperty("/VehicleNumber",e.VehicleNo);s.oLocalVhModel.setProperty("/Plant",e.VehiclePlant);s.oLocalVhModel.setProperty("/Location",e.VehicleLoc);s.oLocalVhModel.setProperty("/CostCenter",e.VehicleCc);s.oLocalModel2.setProperty("/VehicleDDVisible",true);s.getView().getModel("localModel3").setProperty("/VehicleDetVisible",true)},error:function(){sap.m.MessageToast.show("No Data retreived")}})},onSubmitRequest:function(){var e=this.getView().byId("idRequestId").getText();var l=this.getView().byId("IdSelectedVehicle").getSelectedKey();var o={RequestId:e,ApprovalLvl:approval_lvl,FlmVehicleId:l};var t=this.getView().getModel();var s=this;t.create("/ApproveSet",o,{success:function(e,l){sap.m.MessageToast.show("Delivery Vehicle Request Has Been Saved Successfully");s.getView().getModel("localModel3").setProperty("/SumitRequestVisible",false)},error:function(e){var l=jQuery.parseJSON(e.responseText).error.message.value;sap.m.MessageToast.show(l);return}})}})});